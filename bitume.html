<!doctype html>
<html>
<head>
	<title>Bitume MKV</title>
	<meta charset='utf-8'/>
	<link rel='stylesheet' href='bitume.css'/>
	<script>

var GENDER = {
	"female": { 
		"FO": -1, 
		"AG": +1, 
	},
	"male": { 
		"FO": +1, 
		"AG": -1, 
	},
};
var MODIFS = {
	FO:0, AG:0, RA:0, EN:0,
	PR:0, PE:0, IN:0, BE:0,
}

var POINTS = {
	FO:5, AG:5, RA:5, EN:5,
	PR:5, PE:5, IN:5, BE:5,
}

var PC = { };

function dumpPC() {
	console.log(
		 'gender: '+PC.gender+'\n'
		+'FO:'+PC.FO+' AG:'+PC.AG+' RA:'+PC.RA+' EN:'+PC.EN+' '
		+'PR:'+PC.PR+' PE:'+PC.PE+' IN:'+PC.IN+' BE:'+PC.BE
	);
}

function getAttributeType(id) {
	if (id == 'FO' || id == 'AG' || id == 'RA' || id == 'EN'
	 || id == 'PR' || id == 'PE' || id == 'IN' || id == 'BE')
		return 'primary';
	if (id == 'ACR' || id == 'COM' || id == 'CON')
		return 'skill';
	throw "Unknown attribute \""+id+"\"";
}

function getCurrentPrimaryPoints() {
	return POINTS.FO + POINTS.AG + POINTS.RA + POINTS.EN
		 + POINTS.PR + POINTS.PE + POINTS.IN + POINTS.BE;
}

function getAvailablePrimaryPoints() {
	var MAXIMUM_PRIMARY_POINTS = 40;
	return MAXIMUM_PRIMARY_POINTS - getCurrentPrimaryPoints();
}

function updatePCAttribute(id) {
	PC[id] = POINTS[id] + MODIFS[id];
}

function getDefaultMaximum(id) {
	var type = getAttributeType(id);
	if (type == 'primary') return 10;
	if (type == 'skill') return 100;
}

function getMaximum(id) {
	var malus = 0
	if(MODIFS[id] < 0) malus = -MODIFS[id];
	var type = getAttributeType(id);
	return getDefaultMaximum(id) - malus;
}

function getDefaultMinimum(id) {
	var type = getAttributeType(id);
	if (type == 'primary') return 1;
	if (type == 'skill') return 0; //TODO: if skill, it's (A1+A2)/2
}

function getMinimum(id) {
	var bonus = 0
	if(MODIFS[id] > 0) bonus = MODIFS[id];
	var type = getAttributeType(id);
	return getDefaultMinimum(id) + bonus;
}

function updateMinMaxAndValue(id) {
	var e = document.getElementById(id);
	e.value = PC[id];
	e.max = getMaximum(id);
	e.min = getMinimum(id);
	console.log("updateMinMaxAndValue("+id+") value="+e.value+" min="+e.min+" max="+e.max);
}

function updateModifier(op, modifiers, id, key) {
	console.log("updateModifier("+op+", .., "+id+", "+key+")");
	if(!modifiers[key]) return; //DO nothing
	if(op == '-') {
		MODIFS[id] -= modifiers[key][id];
	} else
	if(op == '+') {
		MODIFS[id] += modifiers[key][id];
	} else throw "Unknown operator \""+op+"\"";
	updatePCAttribute(id);
	updateMinMaxAndValue(id);
}

function onModifierChanged(modifiers, id, old_key, new_key) {
	updateModifier('-', modifiers, id, old_key);
	updateModifier('+', modifiers, id, new_key);
}

function onGender(selector) {
	var new_gender = selector.value;
	var hasChanged = new_gender != PC.gender;
	if(new_gender == PC.gender) return; //nothing to do
	onModifierChanged(GENDER, 'FO', PC.gender, new_gender);
	onModifierChanged(GENDER, 'AG', PC.gender, new_gender);
	PC.gender = new_gender;
}

function loadPC() {
	var gender = document.getElementById('gender').value;
	onGender(document.getElementById('gender'));
	dumpPC();
}
	</script>
</head>
<body onload="loadPC()">

<div class='main'>

<h1 class='framed' style='border-width: 5px;'>BITUME</h1>

<div class='column-left framed'>
	<section id='general'>
		<div class='attribute'>
			<label for='name'>NOM</label>
			<input type='text' id='name'>
		</div>
		<div class='attribute'>
			<label for='gender'>SEXE</label>
			<select id='gender' class='combobox' onchange="onGender(this)">
				<option value='female'>Femme</option>
				<option value='male'>Homme</option>
			</select>
		</div>
		<div class='attribute'>
			<label for='tribe'>TRIBU</label>
			<input type='text' id='tribe'>
		</div>
		<div class='attribute'>
			<label for='goal'>BUT</label>
			<input type='text' id='goal'>
		</div>
		<!-- TODO: description -->
	</section>

	<section id='attrs'>
		<h2>CARACTÉRISTIQUES <br/>PRIMAIRES</h2>
		<div class='attribute'>
			<label for='FO'>FORCE (FO)</label>
			<input id='FO' type='number' class='changer' min='1' max='10' value='5'>
		</div>
		<div class='attribute'>
			<label for='AG'>AGILITÉ (AG)</label>
			<input id='AG' type='number' class='changer' min='1' max='10' value='5'>
		</div>
		<div class='attribute'>
			<label for='RA'>RAPIDITÉ (RA)</label>
			<input id='RA' type='number' class='changer'>
		</div>
		<div class='attribute'>
			<label for='EN'>ENDURANCE (EN)</label>
			<input id='EN' type='number' class='changer'>
		</div>
		<div class='attribute'>
			<label for='PR'>PRÉCISION (PR)</label>
			<input id='PR' type='number' class='changer'>
		</div>
		<div class='attribute'>
			<label for='PE'>PERCEPTION (PE)</label>
			<input id='PE' type='number' class='changer'>
		</div>
		<div class='attribute'>
			<label for='IN'>INTELLIGENCE (IN)</label>
			<input id='IN' type='number' class='changer'>
		</div>
		<div class='attribute'>
			<label for='BE'>BEAUTÉ (BE)</label>
			<input id='BE' type='number' class='changer'>
		</div>
	</section>
</div> <!-- end left column-->


<div class='column-right framed'>
	<section>
		<h2>CARACTÉRISTIQUES <br/> SECONDAIRES</h2>
		<div class='attribute'>
			<label for='SI'>SEUIL D'INCONSCIENCE (SI)</label>
			<input type='text' id='SI'>
		</div>
		<div class='attribute'>
			<label for='PV'>POINTS DE VIE (PV)</label>
			<input type='text' id='PV'>
		</div>
		<div class='attribute'>
			<label for='PP'>POINTS DE PRESTIGE (PP)</label>
			<input type='text' id='PP'>
		</div>
		<div class='attribute'>
			<label for='CH'>CHARGE (CH)</label>
			<input type='text' id='CH'>
		</div>
	</section>
	<section>
		<h2>TALENTS</h2>
		<div class='attribute'>
			<label for='ACR'>ACROBATIE (ACR)</label>
			<input type='text' id='ACR'>
		</div>
	</section>
</div> <!-- end right column-->

<div class='column-central'>
	<div class='road'>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
		<div class='dot'>|</div>
	</div>
</div> <!-- end central column-->

</div> <!-- end main-->


</body>
